<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Clientes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f5f7fa; }
        .navbar { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; }
        .container { max-width: 1400px; margin: 30px auto; padding: 0 20px; }
        .card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .back-link { color: #667eea; text-decoration: none; }
        .section-title { font-size: 24px; color: #333; margin: 30px 0 20px 0; padding-bottom: 10px; border-bottom: 3px solid #667eea; }
        .client-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-top: 20px; }
        .client-card { background: white; border: 2px solid #e0e0e0; padding: 20px; border-radius: 8px; }
        .client-card.spot { border-left: 4px solid #f59e0b; }
        .client-card.permanente { border-left: 4px solid #10b981; }
        .client-card h3 { color: #333; margin-bottom: 10px; font-size: 18px; }
        .client-card .tipo { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; margin-bottom: 10px; }
        .tipo.permanente { background: #d1fae5; color: #065f46; }
        .tipo.spot { background: #fed7aa; color: #92400e; }
        .servicios-list { margin-top: 10px; }
        .servicio-item { padding: 8px 0; border-bottom: 1px solid #f0f0f0; font-size: 14px; }
        .ingreso-total { font-size: 24px; font-weight: 700; color: #10b981; margin-top: 10px; }
        .ingreso-anual { font-size: 20px; font-weight: 700; color: #f59e0b; margin-top: 10px; }
        .summary-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; }
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .summary-item h4 { font-size: 14px; opacity: 0.9; margin-bottom: 10px; }
        .summary-item .value { font-size: 32px; font-weight: 700; }
        .summary-item .label { font-size: 13px; opacity: 0.8; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="navbar"><h1>üéØ AgentTracker - Clientes</h1></div>
    <div class="container">
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <a href="{{ url_for('dashboard') }}" class="back-link">‚Üê Volver al Dashboard</a>
                <a href="{{ url_for('nuevo_cliente') }}" style="background: #667eea; color: white; padding: 10px 20px; border-radius: 6px; text-decoration: none; font-weight: 600;">‚ûï Nuevo Cliente</a>
            </div>
            <h2 style="margin: 20px 0;">Clientes de Comsulting</h2>

            <!-- Resumen -->
            <div class="summary-box">
                <div class="summary-grid">
                    <div class="summary-item">
                        <h4>INGRESOS MENSUALES (Permanentes)</h4>
                        <div class="value">{{ total_mensual_permanentes }} UF</div>
                        <div class="label">{{ permanentes_data|length }} clientes</div>
                    </div>
                    <div class="summary-item">
                        <h4>INGRESOS ANUALES (SPOT)</h4>
                        <div class="value">{{ total_anual_spot }} UF</div>
                        <div class="label">{{ spot_data|length }} clientes</div>
                    </div>
                    <div class="summary-item">
                        <h4>INGRESO ANUAL TOTAL</h4>
                        <div class="value">{{ (total_mensual_permanentes * 12 + total_anual_spot)|round(2) }} UF</div>
                        <div class="label">Proyecci√≥n anual completa</div>
                    </div>
                </div>
            </div>

            <!-- CLIENTE INTERNO: COMSULTING -->
            <h2 class="section-title">üè¢ Cliente Interno</h2>
            <div class="client-grid">
                {% for data in permanentes_data %}
                {% if data.cliente.nombre == 'COMSULTING' %}
                <div class="client-card permanente" style="border-left: 4px solid #667eea;">
                    <span class="tipo permanente" style="background: #e0e7ff; color: #3730a3;">INTERNO</span>
                    <h3>{{ data.cliente.nombre }}</h3>
                    <div style="color: #667eea; font-size: 14px; margin-top: 10px;">Trabajos Administrativos e Internos</div>
                    <div class="servicios-list">
                        <strong>Servicios ({{ data.num_servicios }}):</strong>
                        {% for servicio in data.servicios %}
                        <div class="servicio-item">{{ servicio.nombre }}</div>
                        {% endfor %}
                    </div>
                    <div style="margin-top: 15px;">
                        <a href="{{ url_for('editar_cliente', cliente_id=data.cliente.id) }}" style="background: #667eea; color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none; font-size: 14px;">‚úèÔ∏è Editar</a>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>

            <!-- CLIENTES PERMANENTES -->
            <h2 class="section-title">üìå Clientes Permanentes (Ingreso Mensual)</h2>
            <div class="client-grid">
                {% for data in permanentes_data %}
                {% if data.cliente.nombre != 'COMSULTING' %}
                <div class="client-card permanente">
                    <span class="tipo permanente">PERMANENTE</span>
                    <h3>{{ data.cliente.nombre }}</h3>
                    <div class="ingreso-total">{{ data.ingreso_mensual }} UF/mes</div>
                    <div class="servicios-list">
                        <strong>Servicios ({{ data.num_servicios }}):</strong>
                        {% for servicio in data.servicios %}
                        <div class="servicio-item">{{ servicio.nombre }} - {{ servicio.valor_mensual_uf }} UF</div>
                        {% endfor %}
                    </div>
                    <div style="margin-top: 15px;">
                        <a href="{{ url_for('editar_cliente', cliente_id=data.cliente.id) }}" style="background: #667eea; color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none; font-size: 14px;">‚úèÔ∏è Editar</a>
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>

            <!-- CLIENTES SPOT -->
            <h2 class="section-title">‚ö° Clientes SPOT (Ingreso Anual)</h2>
            <div class="client-grid">
                {% for data in spot_data %}
                <div class="client-card spot">
                    <span class="tipo spot">SPOT</span>
                    <h3>{{ data.cliente.nombre }}</h3>
                    <div class="ingreso-anual">{{ data.ingreso_anual }} UF/a√±o</div>
                    <div class="servicios-list">
                        <strong>Servicios ({{ data.num_servicios }}):</strong>
                        {% for servicio in data.servicios %}
                        <div class="servicio-item">{{ servicio.nombre }} - {{ servicio.valor_mensual_uf }} UF (promedio mensual)</div>
                        {% endfor %}
                    </div>
                    <div style="margin-top: 15px;">
                        <a href="{{ url_for('editar_cliente', cliente_id=data.cliente.id) }}" style="background: #f59e0b; color: white; padding: 8px 16px; border-radius: 5px; text-decoration: none; font-size: 14px;">‚úèÔ∏è Editar</a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</body>
</html>
